name: create resource groups and assign contributors.

on: push

env:
  AZURE_ARM_PATH: 'ARM-templates/test/template.json'
  AZURE_ARMPARA_PATH: 'ARM-templates/test/parameters.json'
  CONTRIBUTOR_ROLE_ID: 'b24988ac-6180-42a0-ab88-20f7382dd24c'
# Namen DevOps groep
  Naam1: 'Amy'
  Naam2: 'Titus'
  Naam3: 'Marnix'
  Naam4: 'Loek'
  Naam5: 
# OBJECT ID's DevOps groep  
  ASSIGNEE_OBJ_ID_1: '0000000-0000000-00000000-000000'
  ASSIGNEE_OBJ_ID_2: '0000000-0000000-00000000-000000'
  ASSIGNEE_OBJ_ID_3: '0000000-0000000-00000000-000000'
  ASSIGNEE_OBJ_ID_4: '0000000-0000000-00000000-000000'
  ASSIGNEE_OBJ_ID_5: '0000000-0000000-00000000-000000'

jobs:
  build-and-deploy-to-dev:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: azure/login@v1
      with:
        creds: ${{ secrets.az_sp_github }}

    # ARM template
    # - run:
    #     az deployment create --name demoDeployment --location westeurope --template-file ${{ env.AZURE_ARM_PATH }} --parameters ${{ env.AZURE_ARMPARA_PATH }} 

    - name: Maak een resource groep aan en assign contributor role als naam 1 bestaat
      run: |
        if [ -z "${{ env.Naam1 }}" ]; then
           printf "Er staat geen naam in"
        else
          printf "az group create -l westeurope -n ${{ env.Naam1 }}"
          printf "az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID_1 }} --resource-group ${{ env.Naam1 }}
        fi

    - name: Maak een resource groep aan en assign contributor role als naam 2 bestaat
      run: |
        if [ -z "${{ env.Naam2 }}" ]; then
           printf "Er staat geen naam in"
        else
          printf "az group create -l westeurope -n ${{ env.Naam2 }}"
          printf "az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID_2 }} --resource-group ${{ env.Naam2 }}
        fi    

    - name: Maak een resource groep aan en assign contributor role als naam 3 bestaat
      run: |
        if [ -z "${{ env.Naam3 }}" ]; then
           printf "Er staat geen naam in"
        else
          printf "az group create -l westeurope -n ${{ env.Naam3 }}"
          printf "az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID_3 }} --resource-group ${{ env.Naam3 }}
        fi    

    - name: Maak een resource groep aan en assign contributor role als naam 4 bestaat
      run: |
        if [ -z "${{ env.Naam4 }}" ]; then
           printf "Er staat geen naam in"
        else
          printf "az group create -l westeurope -n ${{ env.Naam4 }}"
          printf "az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID_4 }} --resource-group ${{ env.Naam4 }}
        fi    

    - name: Maak een resource groep aan en assign contributor role als naam 5 bestaat
      run: |
        if [ -z "${{ env.Naam5 }}" ]; then
           printf "Er staat geen naam in"
        else
          printf "az group create -l westeurope -n ${{ env.Naam5 }}"
          printf "az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID_5 }} --resource-group ${{ env.Naam15 }}
        fi 

    - name: logout
      run: |
        az logout

#DIT IS OUDE MEUK
    # - name: create new storage account group
    #   run: |
    #     az storage account create -n ${namen[0]} -g Bullhorn-DEV -l westeurope --sku Standard_LRS

    # - name: loop over array
    #   run: |
    #     for i in ${namen[@]} ;
    #       do
    #         printf "%s\n" "$i"
    #       done  

    # - name: create new resource group
    #   run: |
    #     az group create -l westeurope -n ${{ env.RESOURCE_GR_NAME }}

    # - name: create new role assignment
    #   run: |
    #     az role assignment create --role ${{ env.CONTRIBUTOR_ROLE_ID }} --assignee-object-id ${{ env.ASSIGNEE_OBJ_ID }} --resource-group ${{ env.RESOURCE_GR_NAME }} 

    # namen=( ${{ env.Naam1 }} ${{ env.Naam2 }} ${{ env.Naam3 }} ${{ env.Naam4 }} ) 
    # printf "%s\n" "${namen[@]}"
